<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>日常花费</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon-512.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
        margin: 16px;
    }
    h2 {
        margin-bottom: 10px;
    }
    label {
        font-size: 14px;
        margin-top: 8px;
        display: block;
    }
    input, button {
        padding: 8px;
        margin-top: 4px;
        width: 100%;
        box-sizing: border-box;
        font-size: 14px;
    }
    button {
        margin-top: 10px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 13px;
    }
    table, th, td {
        border: 1px solid #ccc;
    }
    th, td {
        padding: 6px;
        text-align: left;
    }
    .delete-button {
        background: #cc0000;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
    }
    .category-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 4px;
    }
    .category-button {
        flex: 0 0 auto;
        padding: 6px 10px;
        border-radius: 6px;
        border: none;
        background: #cc0000;  /* 未选择：红色 */
        color: white;
        font-size: 13px;
        cursor: pointer;
    }
    .category-button.selected {
        background: #008000;  /* 已选择：绿色 */
    }
</style>
</head>

<body>

<h2>日常花费（€）</h2>

<label>日期：</label>
<input type="date" id="date">

<label>金额（欧元，使用逗号作为小数点，例如：12,50）：</label>
<input type="text" id="amount" placeholder="例如：12,50">

<label>费用分类：</label>
<div id="categoryButtons" class="category-buttons">
    <button type="button" class="category-button" data-category="花费-外出吃饭">花费-外出吃饭</button>
    <button type="button" class="category-button" data-category="花费-超市买菜">花费-超市买菜</button>
    <button type="button" class="category-button" data-category="花费-日常用品">花费-日常用品</button>
    <button type="button" class="category-button" data-category="花费-电器家具">花费-电器家具</button>
    <button type="button" class="category-button" data-category="花费-衣服购物">花费-衣服购物</button>
    <button type="button" class="category-button" data-category="花费-交通出行">花费-交通出行</button>
    <button type="button" class="category-button" data-category="花费-乐乐学习">花费-乐乐学习</button>
</div>

<button onclick="addRecord()">添加记录</button>
<button onclick="exportCSV()">导出为 Excel (CSV)</button>

<table id="recordsTable">
    <thead>
        <tr>
            <th>日期 (dd-MM-yyyy)</th>
            <th>金额 (€，负数)</th>
            <th>分类</th>
            <th>操作</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
// ===================== 基本设置 =====================
const STORAGE_KEY = "cash_records_simple";

// 检测 localStorage 是否可用
let storageAvailable = true;
try {
    localStorage.setItem("__test__", "1");
    localStorage.removeItem("__test__");
} catch (e) {
    st
